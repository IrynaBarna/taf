<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>Test Automation Framework: Using TG objects</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Test Automation Framework
   &#160;<span id="projectnumber">01/31/17/16:21:23</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('tg_usage_page.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Using TG objects </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#tg_usage_sec_1">Traffic Generator Attributes and Methods</a></li>
<li class="level1"><a href="#tg_usage_sniffing">Sniffing</a><ul><li class="level2"><a href="#tg_usage_sniffing_1">Usage example</a></li>
<li class="level2"><a href="#tg_usage_sniffing_2">Description/Features</a></li>
<li class="level2"><a href="#tg_usage_sniffing_3">Full methods references</a></li>
<li class="level2"><a href="#tg_usage_sniffing_4">Packets filtering</a></li>
</ul>
</li>
<li class="level1"><a href="#tg_usage_sending">Sending Packets</a><ul><li class="level2"><a href="#tg_usage_sending_1">Trivial Packet Sending</a></li>
<li class="level2"><a href="#tg_usage_sending_2">Threaded Packet Sending</a></li>
<li class="level2"><a href="#tg_usage_sending_3">Full methods references</a></li>
</ul>
</li>
<li class="level1"><a href="#tg_usage_sec_packets">Working with Packets</a><ul><li class="level2"><a href="#tg_usage_packets_gpf">Get Packet Field</a></li>
<li class="level2"><a href="#tg_usage_packets_gpff">Get Packet Layer in Necessary Format</a></li>
<li class="level2"><a href="#tg_usage_packets_cpf">Check packet field value</a></li>
<li class="level2"><a href="#tg_usage_packets_pd">Get packet dictionary</a></li>
<li class="level2"><a href="#tg_usage_packets_pf">Packet fragmenting and assembling.</a></li>
</ul>
</li>
<li class="level1"><a href="#tg_usage_statistics">Statistics</a></li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="tg_usage_sec_1"></a>
Traffic Generator Attributes and Methods</h1>
<p>All traffic generator objects have to be child of interface class testlib::tg_template::GenericTG</p>
<p>Please read reference above for all available methods.</p>
<dl class="section note"><dt>Note</dt><dd>Support of some methods could be unavailable in some tg types.</dd></dl>
<h1><a class="anchor" id="tg_usage_sniffing"></a>
Sniffing</h1>
<h2><a class="anchor" id="tg_usage_sniffing_1"></a>
Usage example</h2>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;tg_ports = [ports[(<span class="stringliteral">&#39;tg1&#39;</span>, <span class="stringliteral">&#39;sw1&#39;</span>)][1], ports[(<span class="stringliteral">&#39;tg1&#39;</span>, <span class="stringliteral">&#39;sw1&#39;</span>)][2]]</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;env.tg[1].start_sniff(tg_ports, sniffing_time=10, filter_layer=<span class="stringliteral">&quot;STP&quot;</span>)</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">#...</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"># Other steps in case</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">#...</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;data = env.tg[1].stop_sniff(tg_ports)</div>
</div><!-- fragment --><h2><a class="anchor" id="tg_usage_sniffing_2"></a>
Description/Features</h2>
<ul>
<li>Sniffing is performed in background.</li>
<li>Stop_sniff() can be called separately for each port.</li>
<li>Real packets capturing could be started with some delay. We found that different sniffer types don't start capturing right after receiving the command but with some delay. Based on experience this delay is set to 1.5 seconds. Therefore additional time sleep 1.5 seconds is introduced in start_sniff method, which are included in sniffing_time. You have to take this in to account and don't use sniffing time less then 3 seconds (5 is recommended). For benchmarking test cases you have to use special environment like IxNetwork or IxLoad.</li>
<li>You can stop sniffers immediately using force=True parameter. By default stop_sniff returns control only after sniffing_time is elapsed.</li>
</ul>
<h2><a class="anchor" id="tg_usage_sniffing_3"></a>
Full methods references</h2>
<ul>
<li>testlib::tg_template::GenericTG::start_sniff</li>
<li>testlib::tg_template::GenericTG::stop_sniff</li>
</ul>
<h2><a class="anchor" id="tg_usage_sniffing_4"></a>
Packets filtering</h2>
<p>You can check list of run-time filter layers in tg object attribute flt_patterns (testlib::packet_processor::PacketProcessor::flt_patterns).</p>
<p>If you need more complicated filter condition you should use post processing: </p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;lfilter = <span class="keyword">lambda</span> x: x.haslayer(<span class="stringliteral">&quot;STP&quot;</span>) <span class="keywordflow">and</span> x.get_lfield(<span class="stringliteral">&quot;STP&quot;</span>, <span class="stringliteral">&quot;rootid&quot;</span>) == 4096</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;data1 = {}</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="keywordflow">for</span> key <span class="keywordflow">in</span> data.keys():</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;    data1[key] = filter(lfilter, data[key])</div>
</div><!-- fragment --><p> This filter returns the selection of STP BPDU packets with the rootid field equal to 4096.</p>
<p>Using comprehensive lists, the previous example becomes: </p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;lfilter = <span class="keyword">lambda</span> x: x.haslayer(<span class="stringliteral">&quot;STP&quot;</span>) <span class="keywordflow">and</span> x.get_lfield(<span class="stringliteral">&quot;STP&quot;</span>, <span class="stringliteral">&quot;rootid&quot;</span>) == 4096</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;data1 = dict((key, filter(lfilter, data[key])) <span class="keywordflow">for</span> key <span class="keywordflow">in</span> data.keys())</div>
</div><!-- fragment --><h1><a class="anchor" id="tg_usage_sending"></a>
Sending Packets</h1>
<h2><a class="anchor" id="tg_usage_sending_1"></a>
Trivial Packet Sending</h2>
<p>Method send_stream() returns control after packet sending is finished. </p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;tg_port = ports[(<span class="stringliteral">&#39;tg1&#39;</span>, <span class="stringliteral">&#39;sw1&#39;</span>)][1]</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;stream_id = env.tg[1].set_stream(packet_definition, count=5, inter=2, iface=tg_port)</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;env.tg[1].send_stream(stream_id)</div>
</div><!-- fragment --> <dl class="section note"><dt>Note</dt><dd>You should define streams at the beginning of the test case if possible. Then in steps, use only the send_stream method. This manner of packet sending improves test case performance as far as setting stream takes additional time for execution.</dd></dl>
<h2><a class="anchor" id="tg_usage_sending_2"></a>
Threaded Packet Sending</h2>
<p>Method start_streams() returns control immediately after call. Packets will be sent in the background. </p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;tg_port = ports[(<span class="stringliteral">&#39;tg1&#39;</span>, <span class="stringliteral">&#39;sw1&#39;</span>)][1]</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;stream_id_1 = env.tg[1].set_stream(packet_definition_1, count=5, inter=2, iface=tg_port)</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;stream_id_2 = env.tg[1].set_stream(packet_definition_2, count=15, inter=1, iface=tg_port)</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;env.tg[1].start_streams([stream_id_1, stream_id_2, ])</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">#...</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment"># Some staff</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">#...</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;env.tg[1].stop_streams([stream_id_1, stream_id_2, ])</div>
</div><!-- fragment --><dl class="section warning"><dt>Warning</dt><dd>If you'll try to start another stream without stopping the previous one, the first streams will be re-started. This behaviour depends on TG type. Don't use it as a feature.</dd></dl>
<p>The set_stream method has several parameters that allow you to build a packet stream with incremented parameters.</p>
<h2><a class="anchor" id="tg_usage_sending_3"></a>
Full methods references</h2>
<ul>
<li>testlib::tg_template::GenericTG::set_stream</li>
<li>testlib::tg_template::GenericTG::send_stream</li>
<li>testlib::tg_template::GenericTG::start_streams</li>
<li>testlib::tg_template::GenericTG::stop_streams</li>
</ul>
<h1><a class="anchor" id="tg_usage_sec_packets"></a>
Working with Packets</h1>
<p>Traffic Generator objects include set of methods to work with packets (please see testlib::packet_processor::PacketProcessor). But you also can access packet fields directly using internal packet's methods.</p>
<h2><a class="anchor" id="tg_usage_packets_gpf"></a>
Get Packet Field</h2>
<ul>
<li>TG method<ul>
<li>testlib::packet_processor::PacketProcessor::get_packet_field()</li>
</ul>
</li>
</ul>
<h2><a class="anchor" id="tg_usage_packets_gpff"></a>
Get Packet Layer in Necessary Format</h2>
<ul>
<li>TG method<ul>
<li>testlib::packet_processor::PacketProcessor::get_packet_layer()</li>
</ul>
</li>
</ul>
<h2><a class="anchor" id="tg_usage_packets_cpf"></a>
Check packet field value</h2>
<ul>
<li>TG method<ul>
<li>testlib::packet_processor::PacketProcessor::check_packet_field()</li>
<li>testlib::packet_processor::PacketProcessor::check_packet_field_multilayer()</li>
</ul>
</li>
</ul>
<h2><a class="anchor" id="tg_usage_packets_pd"></a>
Get packet dictionary</h2>
<p>Reverse packet building: pypacker packet to packet dictionary.</p>
<ul>
<li>TG method<ul>
<li>testlib::packet_processor::PacketProcessor::packet_dictionary()</li>
</ul>
</li>
</ul>
<h2><a class="anchor" id="tg_usage_packets_pf"></a>
Packet fragmenting and assembling.</h2>
<ul>
<li>TG method<ul>
<li>testlib::packet_processor::PacketProcessor::packet_fragment</li>
<li>testlib::packet_processor::PacketProcessor::assemble_fragmented_packets</li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="tg_usage_statistics"></a>
Statistics</h1>
<p>Traffic Generator object contains number of methods to work with statistics.</p>
<ul>
<li>testlib::tg_template::GenericTG::clear_statistics()</li>
<li>testlib::tg_template::GenericTG::get_sent_frames_count()</li>
<li>testlib::tg_template::GenericTG::get_received_frames_count()</li>
<li>testlib::tg_template::GenericTG::get_filtered_frames_count()</li>
<li>testlib::tg_template::GenericTG::get_uds_3_frames_count()</li>
<li>testlib::tg_template::GenericTG::get_qos_frames_count()</li>
</ul>
<dl class="section note"><dt>Note</dt><dd>Different types of TG could don't have support of some counters. Read appropriate tg type docs. </dd></dl>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Tue Jan 31 2017 16:21:23 for Test Automation Framework by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.6 </li>
  </ul>
</div>
</body>
</html>
